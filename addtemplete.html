<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WP Templates</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #2D3142;
  --accent: #EF8354;
  --accent-light: #FFA07A;
  --bg: #FAF9F6;
  --card-bg: #FFFFFF;
  --text: #2D3142;
  --text-light: #6B7280;
  --border: #E5E7EB;
  --shadow: rgba(45,49,66,0.08);
  --shadow-lg: rgba(45,49,66,0.15);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{
  font-family:'Work Sans',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* Grain overlay */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events:none;
  z-index:9999;
  opacity:0.4;
}

/* Loader */
.loader-overlay{
  position:fixed;inset:0;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  z-index:10000;
  transition:opacity 0.6s ease, visibility 0.6s ease;
}
.loader-overlay.hidden{opacity:0;visibility:hidden;}
.loader-inner{
  display:flex;flex-direction:column;align-items:center;gap:1.5rem;
  animation:loaderPop 0.5s cubic-bezier(0.34,1.56,0.64,1);
}
.loader-icon{
  width:70px;height:70px;
  border-radius:50%;
  border:4px solid var(--border);
  border-top-color:var(--accent);
  animation:spin 0.9s linear infinite;
}
.loader-text{
  font-family:'Playfair Display',serif;
  font-size:1.4rem;color:var(--primary);
  letter-spacing:2px;
  animation:pulse 1.4s ease infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
@keyframes loaderPop{from{opacity:0;transform:scale(0.6);}to{opacity:1;transform:scale(1);}}

/* Nav */
nav{
  background:rgba(255,255,255,0.92);
  backdrop-filter:blur(12px);
  box-shadow:0 2px 24px var(--shadow);
  position:sticky;top:0;z-index:1000;
  animation:slideDown 0.7s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes slideDown{from{transform:translateY(-100%);opacity:0;}to{transform:translateY(0);opacity:1;}}
.nav-inner{
  max-width:1400px;margin:0 auto;
  padding:1.25rem 2rem;
  display:flex;align-items:center;justify-content:space-between;
  gap:1rem;flex-wrap:wrap;
}
.logo{
  font-family:'Playfair Display',serif;
  font-size:1.9rem;font-weight:900;
  background:linear-gradient(135deg,var(--primary) 0%,var(--accent) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.nav-right{display:flex;gap:0.75rem;align-items:center;}
.back-btn{
  display:inline-flex;align-items:center;gap:0.5rem;
  padding:0.65rem 1.25rem;
  border:2px solid var(--border);
  background:var(--bg);
  color:var(--text);
  border-radius:12px;
  font-family:'Work Sans',sans-serif;font-size:0.9rem;font-weight:500;
  text-decoration:none;
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.back-btn:hover{border-color:var(--accent);color:var(--accent);transform:translateX(-3px);}
.back-btn svg{transition:transform 0.3s ease;}
.back-btn:hover svg{transform:translateX(-3px);}
.add-btn{
  display:inline-flex;align-items:center;gap:0.5rem;
  padding:0.75rem 1.5rem;
  background:linear-gradient(135deg,var(--accent),var(--accent-light));
  color:white;border:none;border-radius:12px;
  font-family:'Work Sans',sans-serif;font-size:0.95rem;font-weight:600;
  cursor:pointer;
  box-shadow:0 4px 15px rgba(239,131,84,0.3);
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  letter-spacing:0.5px;
}
.add-btn:hover{transform:translateY(-3px) scale(1.03);box-shadow:0 8px 25px rgba(239,131,84,0.45);}
.add-btn:active{transform:scale(0.97);}
.add-btn .plus{font-size:1.2rem;line-height:1;}

/* Hero */
.hero{
  max-width:1400px;margin:0 auto;
  padding:4rem 2rem 2rem;
  display:flex;align-items:flex-end;justify-content:space-between;gap:1rem;flex-wrap:wrap;
  animation:fadeInUp 0.8s ease both 0.2s;
}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.hero-text h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;
  color:var(--primary);letter-spacing:-2px;line-height:1;
}
.hero-text h1 span{
  background:linear-gradient(135deg,var(--accent),var(--accent-light));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.hero-text p{margin-top:0.75rem;font-size:1.1rem;color:var(--text-light);font-weight:300;}
.hero-count{
  font-family:'Playfair Display',serif;
  font-size:6rem;font-weight:900;
  color:var(--border);
  line-height:1;user-select:none;
  transition:color 0.5s ease;
}

/* Container */
.container{max-width:1400px;margin:0 auto;padding:2rem 2rem 4rem;}

/* Cards Grid */
.cards-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(340px,1fr));
  gap:2rem;
}

/* Card */
.wp-card{
  background:var(--card-bg);
  border-radius:24px;
  overflow:hidden;
  box-shadow:0 4px 20px var(--shadow);
  transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);
  position:relative;
  animation:cardIn 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
  cursor:default;
}
@keyframes cardIn{from{opacity:0;transform:translateY(40px) scale(0.93);}to{opacity:1;transform:translateY(0) scale(1);}}
.wp-card::after{
  content:'';
  position:absolute;top:0;left:0;width:100%;height:3px;
  background:linear-gradient(90deg,var(--accent),var(--accent-light));
  transform:scaleX(0);transform-origin:left;
  transition:transform 0.4s ease;
}
.wp-card:hover::after{transform:scaleX(1);}
.wp-card:hover{transform:translateY(-10px) scale(1.015);box-shadow:0 16px 48px var(--shadow-lg);}

/* Media */
.card-media{
  position:relative;width:100%;
  background:linear-gradient(135deg,#f5f0ea,#e8e2d9);
  overflow:hidden;
}
.card-media img,.card-media video{
  width:100%;display:block;
  max-height:280px;object-fit:cover;
  transition:transform 0.5s ease;
}
.wp-card:hover .card-media img,
.wp-card:hover .card-media video{transform:scale(1.05);}
.no-media{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:140px;gap:0.5rem;
  color:var(--text-light);
}
.no-media svg{opacity:0.4;}
.no-media span{font-size:0.85rem;font-weight:500;letter-spacing:0.5px;}

/* Card Body */
.card-body{padding:1.75rem;}
.card-tag{
  display:inline-block;
  padding:0.3rem 0.8rem;
  background:rgba(239,131,84,0.1);
  color:var(--accent);
  border-radius:8px;
  font-size:0.75rem;font-weight:700;
  text-transform:uppercase;letter-spacing:1px;
  margin-bottom:0.75rem;
}
.card-name{
  font-family:'Playfair Display',serif;
  font-size:1.5rem;font-weight:700;
  color:var(--primary);margin-bottom:0.75rem;
  line-height:1.2;
}
.card-message{
  font-size:0.95rem;color:var(--text-light);
  line-height:1.65;
  display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;
}
.card-footer{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:1.25rem;padding-top:1rem;
  border-top:1px solid var(--border);
}
.card-type-badge{
  display:flex;align-items:center;gap:0.4rem;
  font-size:0.8rem;color:var(--text-light);font-weight:500;
}
.wa-icon{
  width:22px;height:22px;
  background:#25D366;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
}
.wa-icon svg{width:13px;height:13px;fill:white;}

/* Delete btn */
.delete-btn{
  width:32px;height:32px;border:none;
  background:rgba(239,68,68,0.07);
  color:#EF4444;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:all 0.3s ease;
  opacity:0;
}
.wp-card:hover .delete-btn{opacity:1;}
.delete-btn:hover{background:#EF4444;color:white;transform:scale(1.1);}

/* Empty */
.empty-state{
  grid-column:1/-1;
  text-align:center;padding:5rem 2rem;
  animation:fadeInUp 0.6s ease;
}
.empty-icon{font-size:5rem;margin-bottom:1rem;display:block;animation:float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-12px);}}
.empty-state h3{font-family:'Playfair Display',serif;font-size:2rem;color:var(--primary);margin-bottom:0.5rem;}
.empty-state p{color:var(--text-light);font-size:1.05rem;}

/* Error Banner */
.error-banner{
  max-width:1400px;margin:0 auto;
  padding:0 2rem 1.5rem;
  animation:fadeInUp 0.4s ease;
}
.error-inner{
  background:rgba(239,68,68,0.08);
  border:1px solid rgba(239,68,68,0.2);
  border-radius:14px;padding:1rem 1.5rem;
  color:#DC2626;font-size:0.9rem;font-weight:500;
  display:flex;align-items:center;gap:0.5rem;
}

/* Modal */
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(45,49,66,0.75);
  backdrop-filter:blur(8px);
  display:none;align-items:center;justify-content:center;
  z-index:5000;padding:1rem;
}
.modal-overlay.open{display:flex;}
.modal{
  background:var(--card-bg);
  border-radius:28px;
  padding:2.5rem;
  width:100%;max-width:520px;
  max-height:90vh;overflow-y:auto;
  position:relative;
  box-shadow:0 24px 80px rgba(0,0,0,0.25);
  animation:modalIn 0.45s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalIn{from{opacity:0;transform:scale(0.75) translateY(40px);}to{opacity:1;transform:scale(1) translateY(0);}}
.modal-close{
  position:absolute;top:1.5rem;right:1.5rem;
  width:38px;height:38px;
  border:none;background:var(--bg);
  border-radius:50%;font-size:1.4rem;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;color:var(--text);
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.modal-close:hover{background:var(--accent);color:white;transform:rotate(90deg) scale(1.1);}
.modal-title{
  font-family:'Playfair Display',serif;
  font-size:2rem;font-weight:900;
  color:var(--primary);margin-bottom:0.25rem;
}
.modal-sub{color:var(--text-light);font-size:0.9rem;margin-bottom:2rem;}
.form-group{margin-bottom:1.5rem;}
.form-label{
  display:block;
  font-size:0.8rem;font-weight:600;
  color:var(--text);text-transform:uppercase;
  letter-spacing:0.7px;margin-bottom:0.6rem;
}
.form-input,.form-textarea{
  width:100%;padding:1rem 1.1rem;
  border:2px solid var(--border);
  border-radius:14px;
  font-family:'Work Sans',sans-serif;font-size:0.95rem;
  color:var(--text);background:var(--bg);
  transition:all 0.3s ease;
  outline:none;
}
.form-textarea{resize:vertical;min-height:110px;line-height:1.6;}
.form-input:focus,.form-textarea:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(239,131,84,0.12);
  background:white;
}
/* File upload */
.file-upload-area{
  border:2px dashed var(--border);
  border-radius:14px;padding:2rem 1rem;
  text-align:center;cursor:pointer;
  transition:all 0.3s ease;background:var(--bg);
}
.file-upload-area:hover,.file-upload-area.dragover{
  border-color:var(--accent);
  background:rgba(239,131,84,0.04);
}
.file-upload-area input{display:none;}
.file-icon{font-size:2.2rem;margin-bottom:0.5rem;}
.file-upload-area p{font-size:0.9rem;color:var(--text-light);}
.file-upload-area p strong{color:var(--accent);}
.file-name{
  display:none;margin-top:0.75rem;
  font-size:0.85rem;font-weight:600;color:var(--accent);
  background:rgba(239,131,84,0.08);
  padding:0.4rem 1rem;border-radius:8px;display:inline-block;
}
.submit-btn{
  width:100%;padding:1.1rem;
  background:linear-gradient(135deg,var(--accent),var(--accent-light));
  color:white;border:none;border-radius:14px;
  font-family:'Work Sans',sans-serif;font-size:1rem;font-weight:600;
  cursor:pointer;letter-spacing:0.5px;
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow:0 4px 15px rgba(239,131,84,0.3);
  position:relative;overflow:hidden;
}
.submit-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent 0%,rgba(255,255,255,0.15) 50%,transparent 100%);
  transform:translateX(-100%);transition:transform 0.5s ease;
}
.submit-btn:hover::before{transform:translateX(100%);}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(239,131,84,0.45);}
.submit-btn:disabled{opacity:0.55;cursor:not-allowed;transform:none;}
.submit-btn .loading{display:none;}
.submit-btn.loading-state .label{display:none;}
.submit-btn.loading-state .loading{display:inline;}

/* Toast */
.toast{
  position:fixed;bottom:2rem;right:2rem;z-index:9000;
  padding:1rem 1.5rem;border-radius:16px;
  font-size:0.95rem;font-weight:500;
  display:flex;align-items:center;gap:0.75rem;
  box-shadow:0 8px 30px rgba(0,0,0,0.15);
  transform:translateY(100px);opacity:0;
  transition:all 0.45s cubic-bezier(0.34,1.56,0.64,1);
  max-width:360px;
}
.toast.show{transform:translateY(0);opacity:1;}
.toast.success{background:white;border-left:4px solid #10B981;color:#065F46;}
.toast.error{background:white;border-left:4px solid #EF4444;color:#991B1B;}

/* Responsive */
@media(max-width:768px){
  .hero{padding:2.5rem 1.25rem 1.5rem;}
  .hero-count{font-size:4rem;}
  .container{padding:1.5rem 1.25rem 3rem;}
  .cards-grid{grid-template-columns:1fr;}
  .nav-inner{padding:1rem 1.25rem;}
  .logo{font-size:1.5rem;}
  .back-btn span{display:none;}
  .modal{padding:1.75rem 1.5rem;}
  .modal-title{font-size:1.6rem;}
}
@media(max-width:480px){
  .hero-text h1{font-size:2.2rem;}
  .add-btn span{display:none;}
}
</style>
</head>
<body>

<!-- Loader -->
<div class="loader-overlay" id="loader">
  <div class="loader-inner">
    <div class="loader-icon"></div>
    <div class="loader-text">Loading Templates...</div>
  </div>
</div>

<!-- Nav -->
<nav>
  <div class="nav-inner">
    <div class="logo">WP Studio</div>
    <div class="nav-right">
      <a href="/" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        <span>Back Home</span>
      </a>
      <button class="add-btn" id="openModalBtn">
        <span class="plus">+</span>
        <span>New Template</span>
      </button>
    </div>
  </div>
</nav>

<!-- Hero -->
<div class="hero">
  <div class="hero-text">
    <h1>WP <span>Templates</span></h1>
    <p>Craft & manage your WhatsApp message templates</p>
  </div>
  <div class="hero-count" id="heroCount">00</div>
</div>

<!-- Error Banner -->
<div class="error-banner" id="errorBanner" style="display:none;">
  <div class="error-inner">
    <span>‚ö†Ô∏è</span>
    <span id="errorMsg">Could not connect to server. Showing offline state.</span>
  </div>
</div>

<!-- Cards -->
<div class="container">
  <div class="cards-grid" id="wpCards">
    <!-- Cards rendered here -->
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="modal-close" id="closeModal" title="Close">‚úï</button>
    <h2 class="modal-title">New Template</h2>
    <p class="modal-sub">Fill in the details to create a WhatsApp message template</p>

    <form id="wpForm" enctype="multipart/form-data">
      <div class="form-group">
        <label class="form-label" for="nameInput">Template Name</label>
        <input class="form-input" id="nameInput" type="text" name="name" placeholder="e.g. Welcome Message" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="msgInput">WhatsApp Message</label>
        <textarea class="form-textarea" id="msgInput" name="message" placeholder="Hello {{name}}, welcome to our service! üéâ" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Media (Optional)</label>
        <div class="file-upload-area" id="uploadArea">
          <input type="file" name="media" id="mediaInput" accept="image/*,video/*">
          <div class="file-icon">üñºÔ∏è</div>
          <p>Drop your image or video here<br><strong>or click to browse</strong></p>
          <span class="file-name" id="fileName"></span>
        </div>
      </div>
      <button type="submit" class="submit-btn" id="submitBtn">
        <span class="label">‚ú¶ Create Template</span>
        <span class="loading">Creating...</span>
      </button>
    </form>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span id="toastIcon">‚úÖ</span>
  <span id="toastMsg">Template created!</span>
</div>

<script>
const BASE = "https://pcskkwk4w8gsk0s484kwscgw.coolify.phishnix.site/api/";

// --- Toast ---
function showToast(msg, type = "success") {
  const t = document.getElementById("toast");
  document.getElementById("toastIcon").textContent = type === "success" ? "‚úÖ" : "‚ùå";
  document.getElementById("toastMsg").textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove("show"), 3500);
}

// --- Loader ---
function hideLoader() {
  document.getElementById("loader").classList.add("hidden");
}

// --- Hero Count ---
function updateCount(n) {
  const el = document.getElementById("heroCount");
  el.textContent = String(n).padStart(2, "0");
}

// --- Modal ---
const modalOverlay = document.getElementById("modalOverlay");
document.getElementById("openModalBtn").addEventListener("click", () => {
  modalOverlay.classList.add("open");
  setTimeout(() => document.getElementById("nameInput").focus(), 200);
});
document.getElementById("closeModal").addEventListener("click", () => modalOverlay.classList.remove("open"));
modalOverlay.addEventListener("click", e => { if(e.target === modalOverlay) modalOverlay.classList.remove("open"); });
document.addEventListener("keydown", e => { if(e.key === "Escape") modalOverlay.classList.remove("open"); });

// --- File Upload Area ---
const uploadArea = document.getElementById("uploadArea");
const mediaInput = document.getElementById("mediaInput");
const fileName = document.getElementById("fileName");
uploadArea.addEventListener("click", () => mediaInput.click());
mediaInput.addEventListener("change", () => {
  if(mediaInput.files[0]) {
    fileName.textContent = "üìé " + mediaInput.files[0].name;
    fileName.style.display = "inline-block";
  }
});
uploadArea.addEventListener("dragover", e => { e.preventDefault(); uploadArea.classList.add("dragover"); });
uploadArea.addEventListener("dragleave", () => uploadArea.classList.remove("dragover"));
uploadArea.addEventListener("drop", e => {
  e.preventDefault();uploadArea.classList.remove("dragover");
  if(e.dataTransfer.files[0]) {
    mediaInput.files = e.dataTransfer.files;
    fileName.textContent = "üìé " + e.dataTransfer.files[0].name;
    fileName.style.display = "inline-block";
  }
});

// --- Render Cards ---
function renderCards(templates) {
  const container = document.getElementById("wpCards");
  updateCount(templates.length);
  document.getElementById("heroCount").style.color = templates.length > 0 ? "var(--border)" : "var(--border)";

  if(!templates.length) {
    container.innerHTML = `
      <div class="empty-state">
        <span class="empty-icon">üí¨</span>
        <h3>No templates yet</h3>
        <p>Click <strong>New Template</strong> to get started</p>
      </div>`;
    return;
  }

  container.innerHTML = "";
  templates.forEach((t, i) => {
    let mediaHTML = `
      <div class="no-media">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        <span>No Media Attached</span>
      </div>`;
    if(t.type === "image") {
      mediaHTML = `<img src="${BASE}/uploads/${t.media}" alt="${t.name}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'no-media\\'><span>‚ö†Ô∏è Image unavailable</span></div>'">`;
    }
    if(t.type === "video") {
      mediaHTML = `<video controls preload="metadata"><source src="${BASE}/uploads/${t.media}"></video>`;
    }

    const card = document.createElement("div");
    card.className = "wp-card";
    card.style.animationDelay = `${i * 0.07}s`;
    card.innerHTML = `
      <div class="card-media">${mediaHTML}</div>
      <div class="card-body">
        <div class="card-tag">WhatsApp</div>
        <div class="card-name">${escapeHTML(t.name)}</div>
        <div class="card-message">${escapeHTML(t.message)}</div>
        <div class="card-footer">
          <div class="card-type-badge">
            <div class="wa-icon">
              <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            </div>
            ${t.type ? t.type.charAt(0).toUpperCase() + t.type.slice(1) : 'Text'} Template
          </div>
          <button class="delete-btn" title="Delete" onclick="deleteTemplate('${t._id || t.id}')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
          </button>
        </div>
      </div>`;
    container.appendChild(card);
  });
}

function escapeHTML(str) {
  return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

// --- Load Templates ---
async function loadTemplates() {
  try {
    const res = await fetch(`${BASE}/api/wp-template`);
    if(!res.ok) throw new Error("Server error");
    const templates = await res.json();
    renderCards(templates);
    document.getElementById("errorBanner").style.display = "none";
  } catch(err) {
    renderCards([]);
    document.getElementById("errorBanner").style.display = "block";
    document.getElementById("errorMsg").textContent = "Could not connect to server. Start the backend at https://pcskkwk4w8gsk0s484kwscgw.coolify.phishnix.site/api";
  } finally {
    hideLoader();
  }
}

// --- Delete ---
async function deleteTemplate(id){

    if(!confirm("‚ö†Ô∏è Delete this template?")){
        return;
    }

    const res = await fetch(`https://pcskkwk4w8gsk0s484kwscgw.coolify.phishnix.site/api/wp-template/${id}`, {
        method: "DELETE"
    });

    const data = await res.json();

    if(data.success){
        alert("‚úÖ Template deleted");
        loadTemplates();
    } else {
        alert("‚ùå " + data.error);
    }
}

// --- Submit Form ---
document.getElementById("wpForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const btn = document.getElementById("submitBtn");
  btn.classList.add("loading-state");
  btn.disabled = true;
  const formData = new FormData(this);
  try {
    const res = await fetch(`${BASE}/api/wp-template`, { method: "POST", body: formData });
    const data = await res.json();
    if(data.success) {
      showToast("‚ú¶ Template Created Successfully!");
      this.reset();
      fileName.style.display = "none";
      modalOverlay.classList.remove("open");
      loadTemplates();
    } else {
      showToast(data.error || "Something went wrong", "error");
    }
  } catch(err) {
    showToast("Server unreachable. Is backend running?", "error");
  } finally {
    btn.classList.remove("loading-state");
    btn.disabled = false;
  }
});

// --- Init ---
loadTemplates();
</script>
</body>
</html>